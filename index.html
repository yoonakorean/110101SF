<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>1-1 句型填空挑戰</title>
<style>
body { font-family: sans-serif; max-width: 600px; margin: auto; text-align: center; padding: 30px 15px; }
#logo, #logo-game { width: 150px; max-width: 80%; margin-bottom: 10px; display: block; margin-left: auto; margin-right: auto; }
#game-title { font-size: 24px; font-weight: bold; margin-bottom: 10px; }
button { display: block; width: 80%; max-width: 300px; margin: 10px auto; padding: 12px 20px; font-size: 16px; cursor: pointer; }
#check-btn, #next-btn { width: 150px; }
.hidden { display: none; }
.fill-input { width: 120px; padding: 5px; font-size: 16px; text-align:center; }
.question-ko { font-size: 20px; margin: 15px 0; }
.question-ch { font-size: 20px; margin-bottom: 15px; font-weight: bold; }
audio { width: 100%; max-width: 400px; margin-top: 10px; }

#name-form { text-align: center; margin-top: 30px; }
#name-form input { font-size: 20px; padding: 10px; width: 80%; max-width: 300px; display: block; margin: 10px auto; }
#name-form button { font-size: 18px; padding: 10px 20px; }
</style>
</head>
<body>

<!-- 模式選擇 -->
<div id="mode-select">
  <img id="logo" src="logo.png" alt="Logo" />
  <h2>請選擇模式</h2>
  <button id="mode-practice-btn">練習模式（無時間限制）</button>
  <button id="mode-challenge-btn">挑戰模式（限時）</button>
</div>

<!-- 遊戲畫面 -->
<div id="game-area" class="hidden">
  <img id="logo-game" src="logo.png" alt="Logo"/>
  <div id="game-title">1-1 句型填空挑戰</div>
  <div id="question-number"></div>
  <div id="timer" style="font-size:18px; color:red; margin-bottom:15px;"></div>
  <div class="question-ch" id="question-ch"></div>
  <div class="question-ko" id="question-ko"></div>
  <div id="result" style="min-height: 60px; margin-top: 10px;"></div>
  <button id="check-btn" disabled>確認</button>
  <button id="next-btn" style="display:none;">下一題</button>
</div>

<!-- 完成頁面 -->
<div id="end-screen" class="hidden">
  <h2>🎉 全部完成！</h2>
  <form id="name-form">
    <label for="username">請輸入姓名：</label>
    <input type="text" id="username" name="username" required />
    <input type="hidden" id="score" name="score" />
    <input type="hidden" id="time" name="time" />
    <button type="submit">回傳成績</button>
  </form>
</div>

<script>
const questions = [
  { audio: "11010101S.mp3", question: "＿＿가 있어요?", answer: "커피", full: "커피가 있어요?", chinese: "有咖啡嗎？" },
  { audio: "11010102S.mp3", question: "＿＿ ＿＿가 있어요.", answer: "한국 친구", full: "한국 친구가 있어요.", chinese: "有韓國朋友。" },
  { audio: "11010103S.mp3", question: "＿＿이 있어요?", answer: "물", full: "물이 있어요?", chinese: "有水嗎？" },
  { audio: "11010104S.mp3", question: "＿＿이 있어요.", answer: "여권", full: "여권이 있어요.", chinese: "有護照。" },
  { audio: "11010105S.mp3", question: "＿＿가 있어요.", answer: "휴지", full: "휴지가 있어요.", chinese: "有衛生紙。" },
  { audio: "11010106S.mp3", question: "＿＿이 없어요.", answer: "우산", full: "우산이 없어요.", chinese: "沒有雨傘。" },
  { audio: "11010107S.mp3", question: "＿＿이 없어요.", answer: "빵", full: "빵이 없어요.", chinese: "沒有麵包。" },
  { audio: "11010108S.mp3", question: "＿＿이 없어요.", answer: "시간", full: "시간이 없어요.", chinese: "沒有時間。" },
  { audio: "11010109S.mp3", question: "＿＿가 있어요?", answer: "담요", full: "담요가 있어요?", chinese: "有毛毯嗎？" },
  { audio: "11010110S.mp3", question: "＿＿이 있어요?", answer: "화장실", full: "화장실이 있어요?", chinese: "有廁所嗎？" },
  { audio: "11010111S.mp3", question: "＿＿가 없어요.", answer: "강아지", full: "강아지가 없어요.", chinese: "沒有小狗。" },
  { audio: "11010112S.mp3", question: "＿＿가 없어요.", answer: "우유", full: "우유가 없어요.", chinese: "沒有牛奶。" }
];

const modeSelectDiv=document.getElementById("mode-select");
const gameAreaDiv=document.getElementById("game-area");
const questionNumberDiv=document.getElementById("question-number");
const questionChDiv=document.getElementById("question-ch");
const questionKoDiv=document.getElementById("question-ko");
const resultDiv=document.getElementById("result");
const checkBtn=document.getElementById("check-btn");
const nextBtn=document.getElementById("next-btn");
const timerDiv=document.getElementById("timer");
const endScreen=document.getElementById("end-screen");
const scoreInput=document.getElementById("score");
const timeInput=document.getElementById("time");

let shuffledQuestions=[],current=0,correct=0,mode="practice";
let timer=null,timeLeft=0,totalTime=0;

function shuffle(arr){for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}return arr;}

function showMode(m){
  mode=m;
  modeSelectDiv.style.display="none";
  gameAreaDiv.classList.remove("hidden");
  shuffledQuestions=shuffle([...questions]);
  current=0;correct=0;
  if(mode==="challenge"){timeLeft=60*shuffledQuestions.length;startTimer();}
  loadQuestion();
}

function startTimer(){
  totalTime=0;
  timer=setInterval(()=>{
    timeLeft--; totalTime++;
    timerDiv.textContent=`剩餘時間：${timeLeft} 秒`;
    if(timeLeft<=0){clearInterval(timer);endGame();}
  },1000);
}

function loadQuestion(){
  if(current>=shuffledQuestions.length){endGame();return;}
  const q=shuffledQuestions[current];
  questionNumberDiv.textContent=`第 ${current+1} 題 / 共 ${shuffledQuestions.length} 題`;
  questionChDiv.textContent="題目：" + q.chinese;

  const parts=q.question.split("＿＿");
  let html="";
  for(let i=0;i<parts.length;i++){
    html+=parts[i];
    if(i<parts.length-1){
      html+=`<input type="text" class="fill-input" id="fill-${i}" />`;
    }
  }
  questionKoDiv.innerHTML=html;
  resultDiv.innerHTML="";
  checkBtn.disabled=true; nextBtn.style.display="none";

  document.querySelectorAll(".fill-input").forEach(inp=>{
    inp.addEventListener("input",()=>{checkBtn.disabled=[...document.querySelectorAll(".fill-input")].some(x=>x.value.trim()==="");});
  });
}

checkBtn.addEventListener("click",()=>{
  const q=shuffledQuestions[current];
  const userAns=[...document.querySelectorAll(".fill-input")].map(x=>x.value.trim()).join(" ");
  if(userAns===q.answer){resultDiv.innerHTML=`✅ 答對了！<br><strong>${q.full}</strong><br><audio controls src="${q.audio}"></audio>`; correct++;}
  else{resultDiv.innerHTML=`❌ 錯誤<br>正確答案：<strong>${q.full}</strong><br><audio controls src="${q.audio}"></audio>`;}
  checkBtn.disabled=true; nextBtn.style.display="inline-block";
});

nextBtn.addEventListener("click",()=>{current++; loadQuestion();});

function endGame(){
  clearInterval(timer);
  gameAreaDiv.classList.add("hidden");
  // 隱藏題目/答案，只顯示回傳表單
  questionNumberDiv.textContent="";
  questionChDiv.textContent="";
  questionKoDiv.textContent="";
  resultDiv.innerHTML="";
  checkBtn.style.display="none"; nextBtn.style.display="none";

  scoreInput.value=`${correct} / ${shuffledQuestions.length}`;
  timeInput.value=`${totalTime} 秒`;
  endScreen.classList.remove("hidden");
}

document.getElementById("mode-practice-btn").addEventListener("click",()=>showMode("practice"));
document.getElementById("mode-challenge-btn").addEventListener("click",()=>showMode("challenge"));

document.getElementById("name-form").addEventListener("submit",function(e){
  e.preventDefault();
  alert(`姓名：${document.getElementById("username").value}\n分數：${scoreInput.value}\n時間：${timeInput.value}`);
});
</script>
</body>
</html>
